@startuml Booking

!include ./BookingId/BookingId.pu
!include ./Name/Name.pu
!include ./PhoneNumber/PhoneNumber.pu
!include ./CarId/CarId.pu
!include ./MenuId/MenuId.pu
!include ./OptionId/OptionId.pu
!include ./TimeRange/TimeRange.pu
!include ./BookingStatus/BookingStatus.pu
!include ../shared/Money/Money.pu

class "Booking(予約)" as Booking << (R,red) RootEntity >> {
  + bookingId: BookingId
  + customerName: Name
  + phoneNumber: PhoneNumber
  + carId: CarId
  + menuId: MenuId
  + optionIds: OptionId[*]
  + timeRange: TimeRange
  + status: BookingStatus
  + price: Money
}

' 関係（Bookingが内包するVO）
Booking *-- BookingId
Booking *-- Name
Booking *-- PhoneNumber
Booking *-- TimeRange
Booking *-- Money
Booking *-- BookingStatus

' 関係（他コンテキストをID参照するVO）
Booking --> CarId
Booking --> MenuId
Booking --> OptionId

note right of Booking
  【Bookingの基本ルール】

  ■ ステータス
  - Draft      : 下書き（作成直後）
  - Confirmed  : 確定
  - Cancelled  : キャンセル
  - Completed  : 完了

  ■ 変更できるタイミング
  - Draft のときだけ変更できる:
      - price の変更（changePrice）
      - timeRange の変更（reschedule）
      - carId / menuId / optionIds の変更
  - Confirmed / Cancelled / Completed では上記は原則変更しない
    （確定後に変更が必要な場合は、別ユースケースとして扱う）

  ■ optionIds の制約
  - optionIds は重複を許さない（同じ OptionId を2回入れない）
end note

@enduml
